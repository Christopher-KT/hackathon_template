<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Quantum Eye</title>
    <link rel="stylesheet" href="css/adminDashboard.css">
    <link rel="stylesheet" href="css/spreadsheet.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/userProfile.css">
    <link rel="stylesheet" href="css/adminControlPanel.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-timeline@7.5.1/dist/vis-timeline-graph2d.min.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            z-index: 1000;
            background-color: #333;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        #content-area {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: auto;
            transition: margin-left 0.3s ease-in-out;
        }
        #content-area iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #sidebar {
            position: fixed;
            top: 60px;
            left: -250px;
            width: 250px;
            height: calc(100% - 60px);
            transition: left 0.3s ease-in-out;
            background-color: #f1f1f1;
            overflow-y: auto;
            z-index: 999;
        }
        #sidebar.active {
            left: 0;
        }
        #sidebar a {
            padding: 15px 25px;
            text-decoration: none;
            font-size: 18px;
            color: #333;
            display: block;
            transition: 0.3s;
        }
        #sidebar a:hover {
            background-color: #ddd;
        }
        #hamburger {
            font-size: 30px;
            cursor: pointer;
            margin-right: 20px;
        }
        .app-name {
            font-size: 24px;
            font-weight: bold;
        }
        #close-sidebar {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }
        @media (max-width: 768px) {
            #content-area {
                left: 0 !important;
            }
            #sidebar {
                width: 100%;
                left: -100%;
            }
            #sidebar.active {
                left: 0;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div id="hamburger">&#9776;</div>
        <span class="app-name">Quantum Eye</span>
    </nav>
    <div id="sidebar">
        <a href="javascript:void(0)" id="close-sidebar">&times;</a>
        <a href="#" class="sidebar-link" data-content="dashboard">Dashboard</a>
        <a href="#" class="sidebar-link" data-content="admin">Admin Management</a>
        <a href="#" class="sidebar-link" data-content="profile">My Profile</a>
        <a href="#" class="sidebar-link" data-content="settings">Settings</a>
        <a href="#" class="sidebar-link" id="logout-link">Logout</a>
        <a href="#" class="sidebar-link" id="exit-button">Exit</a>
    </div>

    <div id="content-area">
        <iframe id="dashboard-frame" src="spreadsheet.html" style="display:none;"></iframe>
        <iframe id="profile-frame" src="userProfile.html" style="display:none;"></iframe>
        <iframe id="settings-frame" src="settings.html" style="display:none;"></iframe>
        <iframe id="admin-frame" src="adminControlPanel.html" style="display:none;"></iframe>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://visjs.github.io/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const AdminDashboard = {
                contentArea: document.getElementById('content-area'),
                sidebar: document.getElementById('sidebar'),
                sidebarLinks: document.querySelectorAll('.sidebar-link'),
                logoutLink: document.getElementById('logout-link'),
                exitButton: document.getElementById('exit-button'),
                hamburger: document.getElementById('hamburger'),
                closeSidebar: document.getElementById('close-sidebar'),
                currentUser: null,

                init: function() {
                    this.loadCurrentUser();
                    this.setupEventListeners();
                    this.loadInitialContent();
                },

                loadCurrentUser: function() {
                    const userData = sessionStorage.getItem('currentUser');
                    if (userData) {
                        this.currentUser = JSON.parse(userData);
                        if (this.currentUser.role !== 'Admin') {
                            this.redirectToLogin();
                        }
                    } else {
                        this.redirectToLogin();
                    }
                },

                setupEventListeners: function() {
                    this.sidebarLinks.forEach(link => {
                        link.addEventListener('click', (e) => this.handleSidebarLinkClick(e));
                    });

                    this.logoutLink.addEventListener('click', (e) => this.handleLogout(e));
                    this.exitButton.addEventListener('click', (e) => this.handleExit(e));
                    this.hamburger.addEventListener('click', () => this.toggleSidebar());
                    this.closeSidebar.addEventListener('click', () => this.closeSidebarMenu());

                    window.addEventListener('message', (event) => this.handleMessage(event));
                },

                loadInitialContent: function() {
                    this.loadContent('dashboard');
                },

                handleSidebarLinkClick: function(e) {
                    e.preventDefault();
                    const contentId = e.target.getAttribute('data-content');
                    this.loadContent(contentId);

                    if (window.innerWidth <= 768) {
                        this.closeSidebarMenu();
                    }
                },

                handleLogout: function(e) {
                    e.preventDefault();
                    this.logout();
                },

                handleExit: function(e) {
                    e.preventDefault();
                    this.exitApplication();
                },

                handleMessage: function(event) {
                    if (event.data.type === 'spreadsheetLoaded') {
                        console.log('Spreadsheet loaded successfully');
                        this.initializeSpreadsheet();
                    }
                },

                loadContent: function(contentId) {
                    this.hideAllContent();
                    const selectedFrame = document.getElementById(`${contentId}-frame`);

                    if (selectedFrame) {
                        selectedFrame.style.display = 'block';
                        this.initializeContentScripts(contentId);
                    } else {
                        console.error(`Frame not found for content: ${contentId}`);
                    }
                },

                hideAllContent: function() {
                    const frames = document.querySelectorAll('#content-area iframe');
                    frames.forEach(frame => {
                        frame.style.display = 'none';
                    });
                },

                initializeContentScripts: function(contentId) {
                    switch(contentId) {
                        case 'dashboard':
                            this.initializeSpreadsheet();
                            break;
                        case 'settings':
                            this.initializeSettings();
                            break;
                        case 'profile':
                            this.initializeProfile();
                            break;
                        case 'admin':
                            this.initializeAdminPanel();
                            break;
                    }
                },

                toggleSidebar: function() {
                    this.sidebar.classList.toggle('active');
                    this.contentArea.classList.toggle('sidebar-open');
                },

                closeSidebarMenu: function() {
                    this.sidebar.classList.remove('active');
                    this.contentArea.classList.remove('sidebar-open');
                },

                logout: function() {
                    sessionStorage.clear();
                    this.redirectToLogin();
                },

                exitApplication: function() {
                    if (confirm('Are you sure you want to exit? All unsaved changes will be lost.')) {
                        sessionStorage.clear();
                        if ('caches' in window) {
                            caches.keys().then(function(names) {
                                for (let name of names) caches.delete(name);
                            });
                        }
                        this.redirectToLogin();
                        setTimeout(() => {
                            window.close();
                        }, 1000);
                    }
                },

                redirectToLogin: function() {
                    window.location.href = "index.html";
                },

                initializeSpreadsheet: function() {
                    const iframe = document.getElementById('dashboard-frame');
                    if (iframe.contentWindow.initializeSpreadsheet) {
                        iframe.contentWindow.initializeSpreadsheet();
                    } else {
                        console.error('initializeSpreadsheet function not found in iframe');
                    }
                },

                initializeSettings: function() {
                    console.log('Initializing settings');
                    // Implementation for initializing settings
                },

                initializeProfile: function() {
                    console.log('Initializing profile');
                    // Implementation for initializing profile
                },

                initializeAdminPanel: function() {
                    console.log('Initializing admin panel');
                    // Implementation for initializing admin panel
                }
            };

            AdminDashboard.init();
        });
    </script>
</body>
</html>
